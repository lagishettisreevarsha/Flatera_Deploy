<div class="flats-page">

  <!-- Alerts -->
  <div *ngIf="error" class="error">{{ error }}</div>
  <div *ngIf="success" class="success">{{ success }}</div>

  <!-- Header -->
  <div class="page-header">
    <button class="btn-back" (click)="goBack()">← Back to Dashboard</button>
    <h3>Flats</h3>
    <p class="subtitle">Manage flats across towers</p>
  </div>

  <!-- Add Flat -->
  <div class="card">
    <h4>Add New Flat</h4>

    <div class="flat-form">
      <input [(ngModel)]="newFlat.flat_no" name="flat_no" placeholder="Flat Number" />
      <input type="number" [(ngModel)]="newFlat.bedrooms" name="bedrooms" placeholder="Bedrooms" />
      <input type="number" [(ngModel)]="newFlat.sqft" name="sqft" placeholder="Square Feet" />
      <input type="number" [(ngModel)]="newFlat.rent" name="rent" placeholder="Rent Amount" />
      <input type="number" [(ngModel)]="newFlat.floor" name="floor" placeholder="Floor Number" />
      
      <input [(ngModel)]="newFlat.description" name="description" placeholder="Description" />
      <input [(ngModel)]="newFlat.features" name="features" placeholder="Features (comma separated)" />
      
      <label class="checkbox">
        <input type="checkbox" [(ngModel)]="newFlat.is_available" name="is_available" />
        Available
      </label>

      <select [(ngModel)]="newFlat.tower_id" name="tower_id">
        <option [ngValue]="null">Select Tower</option>
        <option *ngFor="let t of towers" [ngValue]="t.id">{{ t.name }}</option>
      </select>

      <button class="btn-primary" (click)="addFlat()">Add Flat</button>
    </div>
  </div>

  <!-- Flats List -->
  <ul class="flat-list">
    <li *ngFor="let f of flats" class="flat-item">

      <!-- Edit Mode -->
      <div
        class="flat-edit"
        *ngIf="editingFlat && editingFlat.id === f.id">

        <input [(ngModel)]="editingFlat.flat_no" name="edit_flat_no" />
        <input type="number" [(ngModel)]="editingFlat.bedrooms" name="edit_bedrooms" />
        <input type="number" [(ngModel)]="editingFlat.sqft" name="edit_sqft" />
        <input type="number" [(ngModel)]="editingFlat.rent" name="edit_rent" />

        <label class="checkbox">
          <input type="checkbox" [(ngModel)]="editingFlat.is_available" name="edit_is_available" />
          Available
        </label>

        <select [(ngModel)]="editingFlat.tower_id" name="edit_tower_id">
          <option *ngFor="let t of towers" [ngValue]="t.id">{{ t.name }}</option>
        </select>

        <div class="actions">
          <button class="btn-primary" (click)="updateFlat()">Save</button>
          <button class="btn-secondary" (click)="cancelEdit()">Cancel</button>
        </div>
      </div>

      <!-- View Mode -->
      <div
        class="flat-view"
        *ngIf="!editingFlat || editingFlat.id !== f.id">

        <div class="info">
          <span class="flat-no">#{{ f.flat_no }}</span>
          <span>{{ f.bedrooms }} bed</span>
          <span>{{ f.sqft }} sqft</span>
          <span>₹{{ f.rent }}</span>
          <span
            class="status"
            [class.available]="f.is_available"
            [class.unavailable]="!f.is_available">
            {{ f.is_available ? 'Available' : 'Unavailable' }}
          </span>
          <!-- console.log(f.is_available) -->
          <span>Tower: {{ getTowerName(f.tower_id) }}</span>
        </div>

        <div class="actions">
          <button class="btn-secondary" (click)="editFlat(f)">Edit</button>
          <button class="btn-danger" (click)="deleteFlat(f.id)">Delete</button>
        </div>
      </div>

    </li>
  </ul>

</div>
