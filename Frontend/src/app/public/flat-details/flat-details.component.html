<div class="flat-details-container" [style]="sanitizer.bypassSecurityTrustStyle('padding: 1.5rem 2rem; max-width: 1400px; margin: 0 auto; position: relative; z-index: 1; min-height: 100vh; background: linear-gradient(135deg, #fafafa 0%, #f5f5f0 50%, #e8e0d5 100%); font-family: Inter, sans-serif; color: #1a1a1a;')">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Loading flat details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
    <button class="back-btn" (click)="goBack()">Back to Flats</button>
  </div>

  <!-- Success State -->
  <div *ngIf="success" class="success-state">
    <p>{{ success }}</p>
  </div>

  <!-- Flat Details -->
  <div *ngIf="flat && !loading" class="flat-content">
    <!-- Header with Back Button -->
    <div class="flat-header">
      <button class="back-btn" (click)="goBack()">
        <span>&larr;</span>
        Back to Flats
      </button>
    </div>

    <!-- Main Content -->
    <div class="flat-main">
      <!-- Details Section -->
      <div class="flat-info">
        <div class="flat-number-header">
          <h1>Flat #{{ flat.flat_no }}</h1>
        </div>
        <div class="info-section">
          <h2>Property Details</h2>
          <p class="description">{{ flat.description }}</p>
          <div class="specs">
            <div class="spec-item">
              <span class="spec-label">Bedrooms:</span>
              <span class="spec-value">{{ flat.bedrooms }}</span>
            </div>
            <div class="spec-item">
              <span class="spec-label">Area:</span>
              <span class="spec-value">{{ flat.sqft }} sqft</span>
            </div>
            <div class="spec-item">
              <span class="spec-label">Rent:</span>
              <span class="spec-value">₹{{ flat.rent | number:'1.0-0' }}/month</span>
            </div>
            <div class="spec-item">
              <span class="spec-label">Location:</span>
              <span class="spec-value">{{ flat.location }}</span>
            </div>
          </div>
        </div>

        <!-- Features Section -->
        <div class="features-section">
          <h2>Amenities & Features</h2>
          <div class="features-grid">
            <div *ngFor="let feature of flat.features" class="feature-item">
              <span class="feature-icon">✓</span>
              <span class="feature-text">{{ feature }}</span>
            </div>
            <!-- Fallback content if no features -->
            <div *ngIf="!flat?.features || flat.features.length === 0" class="feature-item">
              <span class="feature-icon">⚠️</span>
              <span class="feature-text">No features available</span>
            </div>
          </div>
        </div>

        <!-- Booking Section -->
        <div class="booking-section">
          <div class="availability-status" [class.available]="flat.is_available" [class.unavailable]="!flat.is_available">
            {{ flat.is_available ? 'Available' : 'Not Available' }}
          </div>
          
          <button 
            class="book-btn" 
            (click)="bookFlat()"
            [disabled]="!flat.is_available || bookingLoading">
            <span *ngIf="bookingLoading" class="loading-spinner"></span>
            {{ bookingLoading ? 'Processing...' : (flat.is_available ? 'Book This Flat' : 'Currently Unavailable') }}
          </button>
          
          <div class="booking-info">
            <p *ngIf="flat.is_available" class="booking-text">
              <strong>Ready to book?</strong> Click the button above to reserve this flat. 
              You'll receive a confirmation once your booking is processed.
            </p>
            <p *ngIf="!flat.is_available" class="booking-text unavailable">
              This flat is currently occupied. Check back later or explore other available flats.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Error Modal -->
<div *ngIf="showErrorModal" class="modal-overlay" (click)="closeErrorModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Booking Unavailable</h3>
      <button class="modal-close" (click)="closeErrorModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p>{{ modalMessage }}</p>
    </div>
    <div class="modal-footer">
      <button class="modal-btn" (click)="closeErrorModal()">OK</button>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div *ngIf="showSuccessModal" class="modal-overlay" (click)="closeSuccessModal()">
  <div class="modal-content success-modal" (click)="$event.stopPropagation()">
    <div class="modal-header success-header">
      <h3>Booking Submitted</h3>
      <button class="modal-close" (click)="closeSuccessModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p>{{ modalMessage }}</p>
    </div>
    <div class="modal-footer">
      <button class="modal-btn success-btn" (click)="goToMyBookings()">View My Bookings</button>
      <button class="modal-btn secondary-btn" (click)="closeSuccessModal()">Stay Here</button>
    </div>
  </div>
</div>
